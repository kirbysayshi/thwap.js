<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>Thwap Test</title>
		
		<style type="text/css">
		#soldat-stage { border: 1px solid #CCCCCC; }
		</style>
	</head>
	<body id="index" onload="">
		<canvas id="soldat-stage" height="600px" width="700px"></canvas>
		<div id="fpsMeter"></div>
		<script type="text/javascript" charset="utf-8" src='../FPSMonitor.js'></script>
		<script type="text/javascript" charset="utf-8" src='Vector3d.js'></script>
		<script type="text/javascript" charset="utf-8" src='Edge.js'></script>
		<script type="text/javascript" charset="utf-8" src='Math.js'></script>
		<script type="text/javascript" charset="utf-8" src='MinMax.js'></script>
		<script type="text/javascript" charset="utf-8" src='Physics.js'></script>
		<script type="text/javascript" charset="utf-8" src='PhysicsBody.js'></script>
		<script type="text/javascript" charset="utf-8" src='Vertex.js'></script>
		<script type="text/javascript" charset="utf-8" src='Main.js'></script>
		
		<script type="text/javascript">
		window.onload = function(){
			var canvas = document.getElementById("soldat-stage");
			var ctx = canvas.getContext('2d');
			
			var FPSM = new FPSMonitor(30);
			var fps = document.getElementById('fpsMeter');
			
			var SCREEN_WIDTH = 700, SCREEN_HEIGHT = 600;
			world = new Physics(SCREEN_WIDTH, SCREEN_HEIGHT, 0.0, 1, 15);
			
			for( var X = 60; X < SCREEN_WIDTH; X += 100 ) {
				for( var Y = 100; Y < SCREEN_HEIGHT - 100; Y += 100 ) {
					new PhysicsBody(world, 10000).createBox( world, X, Y, 50, 20 ); //Create a few boxes
				}
			}
			
			for( var X = 50; X < SCREEN_WIDTH - 50; X += 130 ) {
				var Body = new PhysicsBody(world, 10000); //Create a few triangles. Only boxes would get boring, right?
            
				var V1 = new Vertex( world, Body, X      , 45, 0 );
				var V2 = new Vertex( world, Body, X +  50, 1 , 0 );
				var V3 = new Vertex( world, Body, X + 100, 45, 0 );
            
				new Edge( world, Body, V1, V2 );
				new Edge( world, Body, V2, V3 );
				new Edge( world, Body, V3, V1 );
			}
			
			new PhysicsBody(world, 1000000).createBox( world, 10, 400, 200, 50 ); //Create a few boxes
			//new PhysicsBody(world, 100).createBox( world, 30, 80, 50, 50 ); //Create a few boxes
			//new PhysicsBody(world, 100).createBox( world, 30, 100, 50, 50 ); //Create a few boxes
			new PhysicsBody(world, 10000).createCircle( world, 200, 50, 25, 8);
			
			//new PhysicsBody(world, 100000000).createFixedBox( world, 0, SCREEN_HEIGHT - 400, SCREEN_WIDTH, 30 ); //Create a few boxes
			
			var angled = new PhysicsBody(world, 10000);
			var p1 = new Vertex( world, angled, 20, 100, 0, 10000, true);
			var p2 = new Vertex( world, angled, 500, 200, 0, 10000, true);
			var p3 = new Vertex( world, angled, 500, 220, 0, 10000, true);
			var p4 = new Vertex( world, angled, 20, 120, 0, 10000, true);
			
			new Edge( world, angled, p1, p2, true );
			new Edge( world, angled, p2, p3, true );
			new Edge( world, angled, p3, p4, true );
			new Edge( world, angled, p4, p1, true );
			
			new Edge( world, angled, p1, p3, false );
			new Edge( world, angled, p4, p2, false );
			

			// make some platforms!
			var path2 = new PhysicsBody(world, 10000).createFromPath(world, [
				{ x: 64, y: 328, z: 0 }, { x: 343, y: 298, z: 0 }, { x: 403, y: 328, z: 0 }, { x: 404, y: 395, z: 0 }, 
				{ x: 65, y: 405, z: 0 }, { x: 64, y: 328, z: 0 } // repeat first point 
			], true);

			//var path3 = new PhysicsBody(world, 10000).createFromPath(world, [
			//	{ x: 428, y: 534, z: 0 }, { x: 829, y: 461, z: 0 }, { x: 928, y: 437, z: 0 }, { x: 931, y: 633, z: 0 }, 
			//	{ x: 427, y: 551, z: 0 }, { x: 428, y: 534, z: 0 } // repeat first point 
			//], true);

			//var path4 = new PhysicsBody(world, 10000).createFromPath(world, [
			//	{ x: 31, y: 173, z: 0 }, { x: 254, y: 173, z: 0 }, { x: 254, y: 163, z: 0 }, { x: 29, y: 157, z: 0 }, 
			//	{ x: 31, y: 173, z: 0 } // repeat first point
			//], true);
			
			var hero = new PhysicsBody(world, 10000).createBox( world, 20, 10, 10, 50 );
			
			var intVal = setInterval(function(){
				world.update();
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				world.render(ctx);
				fps.innerHTML = FPSM.check();
			}, 33);
			
			window.addEventListener('keydown', function(e){
				if(e.keyCode == 17) {
					clearInterval(intVal);
					console.log("execution stopped");
				}
				
				if(e.keyCode == 68) { // D
					//circle.applyImpulseForce(new TVector(1, 0, 0));
					hero.applyForce(new Vector3d(10, 0, 0));
				}
				
				if(e.keyCode == 65) { // A
					//circle.applyImpulseForce(new TVector(-1, 0, 0));
					hero.applyForce(new Vector3d(-10, 0, 0));
				}
				
				if(e.keyCode == 32){
					hero.applyForce(new Vector3d(0, -10, 0));
				}
				
			}, false);
			
		};
		</script>
	</body>
</html>
